<div class="container mt-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="page-title">User Dashboard</h5>

    <button mat-button class="add-user-btn" (click)="openForm()">
      Add User
    </button>
  </div>
  @if (isUserFormOpen) {
    <div class="custom-overlay" (click)="closeForm()">
      <div class="custom-modal" (click)="$event.stopPropagation()">
        <ng-container
          *ngComponentOutlet="
            userFormComponent;
            inputs: {
              mode: formMode,
              user: selectedUser,
              onClose: closeForm.bind(this),
            }
          "
        ></ng-container>
      </div>
    </div>
  }

  <div class="row g-4">
    <!-- TABLE CARD -->
    <div class="col-lg-7">
      <mat-card class="dashboard-card">
        <table mat-table [dataSource]="dataSource" class="w-100">
          <ng-container matColumnDef="name">
            <th
              mat-header-cell
              *matHeaderCellDef
              (click)="sortByName()"
              style="cursor: pointer"
            >
              Name
              <span class="sort-icon">
                {{ sortDirection === "asc" ? "↑" : "↓" }}
              </span>
            </th>

            <td mat-cell *matCellDef="let u">{{ u.name }}</td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let u">{{ u.email }}</td>
          </ng-container>

          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef>Role</th>
            <td mat-cell *matCellDef="let u">{{ u.role }}</td>
          </ng-container>
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let u">
              <button mat-button color="primary" (click)="editUser(u)">
                Edit
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="cols"></tr>
          <tr mat-row *matRowDef="let row; columns: cols"></tr>
        </table>
      </mat-card>

      <div class="d-flex justify-content-end">
        <mat-paginator
          [pageSize]="defaultPageSize"
          [pageSizeOptions]="pageSizeOptions"
          showFirstLastButtons
        >
        </mat-paginator>
      </div>
    </div>

    <!-- CHART CARD -->
    <div class="col-lg-5">
      <mat-card class="dashboard-card chart-card">
        <h6 class="chart-title">User Roles Distribution</h6>

        <div class="chart-wrapper">
          <canvas #chart></canvas>
        </div>
      </mat-card>
    </div>
  </div>
</div>
